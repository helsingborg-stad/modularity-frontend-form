var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!="symbol"?key+"":key,value);const _FieldGroupSelect=class _FieldGroupSelect{constructor(store,modularityFrontendFormAdminData2,field,groupId){this.store=store,this.modularityFrontendFormAdminData=modularityFrontendFormAdminData2,this.field=field,this.groupId=groupId,this.group=this.store.get(this.groupId),this.select=this.field.querySelector("select"),this.wordpressDefaultFields=this.modularityFrontendFormAdminData.modularityFrontendFormAcfGroups[this.modularityFrontendFormAdminData.modularityFrontendFormWordpressFieldsKey]||{},this.group?.postTypeSelect||!this.select?(this.postTypeSelect=this.group.postTypeSelect,this.init()):console.error(`PostTypeSelect not found for group ID: ${this.groupId}`)}group;postTypeSelect;select;selectedCache={};postTypeKeyToCache=null;wordpressDefaultFields={};init(){this.postTypeSelect&&(this.postTypeKeyToCache=this.postTypeSelect.getSelected(),this.updateOptions())}updateOptions(){this.postTypeSelect&&(this.setSelectedCache(),this.updateMarkup(this.postTypeSelect.getSelected()),this.postTypeKeyToCache=this.postTypeSelect.getSelected())}setSelectedCache(){if(!this.postTypeKeyToCache)return;const result=[...this.select.selectedOptions].map(opt=>({index:opt.dataset.i?Number(opt.dataset.i):null,value:opt.value})).sort((a,b)=>a.index===null&&b.index===null?0:a.index===null?1:b.index===null?-1:a.index-b.index).map(x=>x.value);this.selectedCache[this.postTypeKeyToCache]=result}updateMarkup(selectedPostType){this.select.length=0;let groups=selectedPostType?this.modularityFrontendFormAdminData.modularityFrontendFormAcfGroups[selectedPostType]:{};if(groups={...groups,...this.wordpressDefaultFields},!groups||!selectedPostType)return;const keys=Object.keys(groups),selected=this.selectedCache[selectedPostType]??[],orderedKeyss=[...keys.filter(key=>!selected.includes(key)),...selected];for(const groupKey of orderedKeyss){const group=groups[groupKey];if(!group)continue;const option=this.createOption(groupKey,group,selected.includes(groupKey)||!1);this.select.add(option)}}createOption(value,text,selected){const option=document.createElement("option");return option.value=value,option.text=text,option.selected=selected,option}static createInstance(store,modularityFrontendFormAdminData2,field,groupId){return new _FieldGroupSelect(store,modularityFrontendFormAdminData2,field,groupId)}};__name(_FieldGroupSelect,"FieldGroupSelect");let FieldGroupSelect=_FieldGroupSelect;const _PostTypeSelect=class _PostTypeSelect{constructor(store,field,groupId){this.store=store,this.field=field,this.groupId=groupId,this.select=this.field.querySelector("select"),this.select?this.init():console.error(`Select element not found in field for group ID: ${this.groupId}`)}select;init(){this.select.addEventListener("change",e=>{this.store.get(this.groupId)?.fields.forEach(fieldGroupSelect=>{fieldGroupSelect.updateOptions()})})}getSelected(){return this.select.value||null}static createInstance(store,field,groupId){return new _PostTypeSelect(store,field,groupId)}};__name(_PostTypeSelect,"PostTypeSelect");let PostTypeSelect=_PostTypeSelect;const _FieldGroupSetup=class _FieldGroupSetup{constructor(store,modularityFrontendFormAdminData2){this.store=store,this.modularityFrontendFormAdminData=modularityFrontendFormAdminData2}ACF_GROUP_SELECT_NAME="formStepGroup";init(){acf.addAction(`load_field/name=${this.ACF_GROUP_SELECT_NAME}`,field=>{this.initFields(field)}),acf.addAction(`append_field/name=${this.ACF_GROUP_SELECT_NAME}`,field=>{this.initFields(field)})}initFields(field){const result=this.getGroupId(field);if(!result)return;const[groupElement,groupId]=result;if(!this.store.get(groupId)){const postTypeSelect=this.getPostTypeSelect(groupElement);if(!postTypeSelect){console.error(`Missing post type select element for group: ${groupElement[0]}`);return}const fieldStorage=this.store.set(groupId,{id:groupId,postTypeSelect:null,group:groupElement[0],fields:[]});this.store.setPostTypeSelect(fieldStorage.id,PostTypeSelect.createInstance(this.store,postTypeSelect,fieldStorage.id))}this.getPostTypeSelect(groupElement)?.addEventListener("change",()=>{this.store.get(groupId)?.fields.forEach(fieldGroupSelect=>{fieldGroupSelect.updateOptions()})}),this.store.addFieldToGroup(groupId,FieldGroupSelect.createInstance(this.store,this.modularityFrontendFormAdminData,field.$el[0],groupId))}getPostTypeSelect(groupElement){const postTypeSelect=acf.getFields({name:"saveToPostType",parent:groupElement});return postTypeSelect&&postTypeSelect.length>0&&postTypeSelect[0].$el[0]?postTypeSelect[0].$el[0]:null}getGroupId(field){if(!field.$el[0])return console.error("ACF field element not found."),null;const selector=pagenow==="mod-frontend-form"?'[id^="acf-group_"]':'.wp-block[id^="block-"]',fieldGroupElement=field.$el.closest(selector);if(!fieldGroupElement||fieldGroupElement.length===0)return console.error("ACF field group not found."),null;const groupId=fieldGroupElement[0].id;return[fieldGroupElement,groupId]}};__name(_FieldGroupSetup,"FieldGroupSetup");let FieldGroupSetup=_FieldGroupSetup;const _Store=class _Store{constructor(){}set(id,fieldStorage){return _Store.fieldStorage[id]=fieldStorage,_Store.fieldStorage[id]}get(id){return _Store.fieldStorage[id]?_Store.fieldStorage[id]:null}setPostTypeSelect(id,postTypeSelect){_Store.fieldStorage[id]&&(_Store.fieldStorage[id].postTypeSelect=postTypeSelect)}addFieldToGroup(id,field){_Store.fieldStorage[id]&&_Store.fieldStorage[id].fields.push(field)}static initStore(){return _Store.instance||(_Store.instance=new _Store),_Store.instance}};__name(_Store,"Store"),__publicField(_Store,"instance"),__publicField(_Store,"fieldStorage",{});let Store=_Store;const _Admin=class _Admin{constructor(){this.initAcfSelects()}initAcfSelects(){typeof acf<"u"&&new FieldGroupSetup(Store.initStore(),modularityFrontendFormAdminData).init()}};__name(_Admin,"Admin");let Admin=_Admin;new Admin;
//# sourceMappingURL=admin.BGufm6y4.js.map
