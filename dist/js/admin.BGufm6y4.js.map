{"version":3,"file":"admin.BGufm6y4.js","sources":["../../source/js/admin/acf/fieldGroupSelect.ts","../../source/js/admin/acf/postTypeSelect.ts","../../source/js/admin/acf/fieldGroupSetup.ts","../../source/js/admin/acf/store.ts","../../source/js/admin/admin.ts"],"sourcesContent":["class FieldGroupSelect implements FieldGroupSelectInterface {\n\tprivate group!: FieldStorage;\n\tprivate postTypeSelect!: PostTypeSelectInterface;\n\tprivate select!: HTMLSelectElement;\n\tprivate selectedCache: { [key: string]: string[] } = {};\n\tprivate postTypeKeyToCache: string | null = null;\n\tprivate wordpressDefaultFields: { [key: string]: string } = {};\n\n\tprivate constructor(\n\t\tprivate store: StoreInterface,\n\t\tprivate modularityFrontendFormAdminData: ModularityFrontendFormAdminData,\n\t\tprivate field: HTMLElement,\n\t\tprivate groupId: string,\n\t) {\n\t\tthis.group = this.store.get(this.groupId) as FieldStorage;\n\t\tthis.select = this.field.querySelector('select') as HTMLSelectElement;\n\t\tthis.wordpressDefaultFields =\n\t\t\tthis.modularityFrontendFormAdminData.modularityFrontendFormAcfGroups[\n\t\t\t\tthis.modularityFrontendFormAdminData.modularityFrontendFormWordpressFieldsKey\n\t\t\t] || {};\n\n\t\tif (this.group?.postTypeSelect || !this.select) {\n\t\t\tthis.postTypeSelect = this.group.postTypeSelect as PostTypeSelectInterface;\n\t\t\tthis.init();\n\t\t} else {\n\t\t\tconsole.error(`PostTypeSelect not found for group ID: ${this.groupId}`);\n\t\t}\n\t}\n\n\t/**\n\t * Initializes the FieldGroupSelect instance.\n\t */\n\tprivate init() {\n\t\tif (!this.postTypeSelect) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.postTypeKeyToCache = this.postTypeSelect.getSelected();\n\t\tthis.updateOptions();\n\t}\n\n\t/**\n\t * Updates the options in the select element based on the selected post type.\n\t */\n\tpublic updateOptions(): void {\n\t\tif (!this.postTypeSelect) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSelectedCache();\n\t\tthis.updateMarkup(this.postTypeSelect.getSelected());\n\t\tthis.postTypeKeyToCache = this.postTypeSelect.getSelected();\n\t}\n\n\t/**\n\t * Caches the currently selected options for the current post type.\n\t * The sorting part is necessary due to the element not being structured after page reload.\n\t */\n\tprivate setSelectedCache(): void {\n\t\tif (!this.postTypeKeyToCache) return;\n\n\t\tconst result = [...this.select.selectedOptions]\n\t\t\t.map((opt) => ({\n\t\t\t\tindex: opt.dataset.i ? Number(opt.dataset.i) : null,\n\t\t\t\tvalue: opt.value,\n\t\t\t}))\n\t\t\t.sort((a, b) => {\n\t\t\t\tif (a.index === null && b.index === null) return 0;\n\t\t\t\tif (a.index === null) return 1;\n\t\t\t\tif (b.index === null) return -1;\n\t\t\t\treturn a.index - b.index;\n\t\t\t})\n\t\t\t.map((x) => x.value);\n\n\t\tthis.selectedCache[this.postTypeKeyToCache] = result;\n\t}\n\n\t/**\n\t * Updates the select markup based on the selected post type.\n\t *\n\t * @param selectedPostType\n\t * @returns\n\t */\n\tprivate updateMarkup(selectedPostType: string | null): void {\n\t\tthis.select.length = 0;\n\n\t\tlet groups = selectedPostType\n\t\t\t? this.modularityFrontendFormAdminData.modularityFrontendFormAcfGroups[selectedPostType]\n\t\t\t: {};\n\n\t\tgroups = { ...groups, ...this.wordpressDefaultFields };\n\n\t\tif (!groups || !selectedPostType) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = Object.keys(groups);\n\t\tconst selected = this.selectedCache[selectedPostType] ?? [];\n\t\tconst notSelected = keys.filter((key) => !selected.includes(key));\n\n\t\tconst orderedKeyss = [...notSelected, ...selected];\n\n\t\tfor (const groupKey of orderedKeyss) {\n\t\t\tconst group = groups[groupKey];\n\t\t\tif (!group) continue;\n\n\t\t\tconst option = this.createOption(groupKey, group, selected.includes(groupKey) || false);\n\n\t\t\tthis.select.add(option);\n\t\t}\n\t}\n\n\tprivate createOption(value: string, text: string, selected: boolean): HTMLOptionElement {\n\t\tconst option = document.createElement('option');\n\t\toption.value = value;\n\t\toption.text = text;\n\t\toption.selected = selected;\n\t\treturn option;\n\t}\n\n\tpublic static createInstance(\n\t\tstore: StoreInterface,\n\t\tmodularityFrontendFormAdminData: ModularityFrontendFormAdminData,\n\t\tfield: HTMLElement,\n\t\tgroupId: string,\n\t): FieldGroupSelect {\n\t\treturn new FieldGroupSelect(store, modularityFrontendFormAdminData, field, groupId);\n\t}\n}\n\nexport default FieldGroupSelect;\n","class PostTypeSelect implements PostTypeSelectInterface {\n\tprivate select: HTMLSelectElement;\n\tprivate constructor(\n\t\tprivate store: StoreInterface,\n\t\tprivate field: HTMLElement,\n\t\tprivate groupId: string,\n\t) {\n\t\tthis.select = this.field.querySelector('select') as HTMLSelectElement;\n\n\t\tif (!this.select) {\n\t\t\tconsole.error(`Select element not found in field for group ID: ${this.groupId}`);\n\t\t} else {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes the PostTypeSelect instance.\n\t */\n\tprivate init(): void {\n\t\tthis.select.addEventListener('change', (e: Event) => {\n\t\t\tthis.store.get(this.groupId)?.fields.forEach((fieldGroupSelect: FieldGroupSelectInterface) => {\n\t\t\t\tfieldGroupSelect.updateOptions();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Gets the currently selected post type.\n\t * @returns string | null\n\t */\n\tpublic getSelected(): string | null {\n\t\treturn this.select.value || null;\n\t}\n\n\tpublic static createInstance(store: StoreInterface, field: HTMLElement, groupId: string): PostTypeSelect {\n\t\treturn new PostTypeSelect(store, field, groupId);\n\t}\n}\n\nexport default PostTypeSelect;\n","import FieldGroupSelect from './fieldGroupSelect';\nimport PostTypeSelect from './postTypeSelect';\ndeclare const acf: any;\ndeclare const wp: any;\ndeclare const pagenow: string;\n\nclass FieldGroupSetup implements AcfSelectsInterface {\n\tprivate ACF_GROUP_SELECT_NAME = 'formStepGroup';\n\n\tpublic constructor(\n\t\tprivate store: StoreInterface,\n\t\tprivate modularityFrontendFormAdminData: ModularityFrontendFormAdminData,\n\t) {}\n\n\t/**\n\t * Initializes ACF field listeners for loading and appending fields.\n\t */\n\tpublic init(): void {\n\t\tacf.addAction(`load_field/name=${this.ACF_GROUP_SELECT_NAME}`, (field: AcfField) => {\n\t\t\tthis.initFields(field);\n\t\t});\n\n\t\tacf.addAction(`append_field/name=${this.ACF_GROUP_SELECT_NAME}`, (field: AcfField) => {\n\t\t\tthis.initFields(field);\n\t\t});\n\t}\n\n\t/**\n\t * Stores the ACF field instance in the field storage.\n\t *\n\t * @param field\n\t */\n\tprivate initFields(field: AcfField): void {\n\t\tconst result = this.getGroupId(field);\n\t\tif (!result) return;\n\t\tconst [groupElement, groupId] = result;\n\n\t\tif (!this.store.get(groupId)) {\n\t\t\tconst postTypeSelect = this.getPostTypeSelect(groupElement);\n\n\t\t\tif (!postTypeSelect) {\n\t\t\t\tconsole.error(`Missing post type select element for group: ${groupElement[0]}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fieldStorage = this.store.set(groupId, {\n\t\t\t\tid: groupId,\n\t\t\t\tpostTypeSelect: null,\n\t\t\t\tgroup: groupElement[0],\n\t\t\t\tfields: [],\n\t\t\t});\n\n\t\t\tthis.store.setPostTypeSelect(\n\t\t\t\tfieldStorage.id,\n\t\t\t\tPostTypeSelect.createInstance(this.store, postTypeSelect, fieldStorage.id),\n\t\t\t);\n\t\t}\n\n\t\tthis.getPostTypeSelect(groupElement)?.addEventListener('change', () => {\n\t\t\tthis.store.get(groupId)?.fields.forEach((fieldGroupSelect: FieldGroupSelectInterface) => {\n\t\t\t\tfieldGroupSelect.updateOptions();\n\t\t\t});\n\t\t});\n\n\t\tthis.store.addFieldToGroup(\n\t\t\tgroupId,\n\t\t\tFieldGroupSelect.createInstance(this.store, this.modularityFrontendFormAdminData, field.$el[0], groupId),\n\t\t);\n\t}\n\n\t/**\n\t * Retrieves the post type select element within a given group element.\n\t *\n\t * @param groupElement\n\t * @returns HTMLElement | null\n\t */\n\tprivate getPostTypeSelect(groupElement: JQuery<HTMLElement>): HTMLElement | null {\n\t\tconst postTypeSelect = acf.getFields({\n\t\t\tname: 'saveToPostType',\n\t\t\tparent: groupElement,\n\t\t});\n\n\t\treturn postTypeSelect && postTypeSelect.length > 0 && postTypeSelect[0].$el[0] ? postTypeSelect[0].$el[0] : null;\n\t}\n\n\t/**\n\t * Gets the group ID and element for a given ACF field.\n\t *\n\t * @param field\n\t * @returns\n\t */\n\tprivate getGroupId(field: AcfField): null | [JQuery<HTMLElement>, string] {\n\t\tif (!field.$el[0]) {\n\t\t\tconsole.error('ACF field element not found.');\n\t\t\treturn null;\n\t\t}\n\n\t\tconst selector = pagenow === 'mod-frontend-form' ? '[id^=\"acf-group_\"]' : '.wp-block[id^=\"block-\"]';\n\n\t\tconst fieldGroupElement = field.$el.closest(selector);\n\n\t\tif (!fieldGroupElement || fieldGroupElement.length === 0) {\n\t\t\tconsole.error('ACF field group not found.');\n\t\t\treturn null;\n\t\t}\n\n\t\tconst groupId = fieldGroupElement[0].id;\n\n\t\treturn [fieldGroupElement, groupId];\n\t}\n}\n\nexport default FieldGroupSetup;\n","class Store implements StoreInterface {\n\tprivate static instance: Store;\n\tprivate static fieldStorage: { [key: string]: FieldStorage } = {};\n\tprivate constructor() {}\n\n\t/**\n\t * Sets the field storage for a given ID.\n\t *\n\t * @param id\n\t * @param fieldStorage\n\t */\n\tpublic set(id: string, fieldStorage: FieldStorage): FieldStorage {\n\t\tStore.fieldStorage[id] = fieldStorage;\n\t\treturn Store.fieldStorage[id];\n\t}\n\n\t/**\n\t * Retrieves the field storage for a given ID.\n\t *\n\t * @param id\n\t */\n\tpublic get(id: string): FieldStorage | null {\n\t\treturn Store.fieldStorage[id] ? Store.fieldStorage[id] : null;\n\t}\n\n\tpublic setPostTypeSelect(\n\t\tid: string,\n\t\tpostTypeSelect: PostTypeSelectInterface,\n\t): void {\n\t\tif (Store.fieldStorage[id]) {\n\t\t\tStore.fieldStorage[id].postTypeSelect = postTypeSelect;\n\t\t}\n\t}\n\n\t/**\n\t * Adds a field to a group for a given ID.\n\t *\n\t * @param id\n\t * @param field\n\t */\n\tpublic addFieldToGroup(id: string, field: FieldGroupSelectInterface): void {\n\t\tif (Store.fieldStorage[id]) {\n\t\t\tStore.fieldStorage[id].fields.push(field);\n\t\t}\n\t}\n\n\t/**\n\t * Initializes and returns the singleton instance of the Store.\n\t */\n\tpublic static initStore(): Store {\n\t\tif (!Store.instance) {\n\t\t\tStore.instance = new Store();\n\t\t}\n\n\t\treturn Store.instance;\n\t}\n}\n\nexport default Store;\n","import FieldGroupSetup from './acf/fieldGroupSetup';\nimport Store from './acf/store';\n\ndeclare const acf: any;\ndeclare const modularityFrontendFormAdminData: ModularityFrontendFormAdminData;\n\nclass Admin {\n\tconstructor() {\n\t\tthis.initAcfSelects();\n\t}\n\n\t/**\n\t * Initializes ACF selects.\n\t */\n\tprivate initAcfSelects(): void {\n\t\tif (typeof acf !== 'undefined') {\n\t\t\tnew FieldGroupSetup(Store.initStore(), modularityFrontendFormAdminData).init();\n\t\t}\n\t}\n}\n\nnew Admin();\n"],"names":["modularityFrontendFormAdminData"],"mappings":"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"}